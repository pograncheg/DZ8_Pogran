<html lang="ru"><head>
    <title>Chess Board HTML5</title>
    <meta charset="UTF-8">
    <style>
        .body {
            background-color: #eeeeee;
        }

        tr, td {
            user-select: none;
        }

        .box {
            text-align: center;
        }

        .centered {
            display: inline-block;
            margin: 0;
        }

        .chess-board {
            border-spacing: 0;
            border-collapse: collapse;
        }

        .chess-board th {
            padding: .5em;
        }

        .chess-board td {
            border: 1px solid;
            width: 5em;
            height: 5em;
            text-align: center;
            vertical-align: middle;
        }

        .chess-board .white {
            background: #f0d9b5;
        }

        .chess-board .black {
            background: #b58863;
        }

        a:link, a:active {
            text-decoration: none;
            color: #006699;
        }

        a:visited {
            text-decoration: none;
            color: #003399;
        }

        a:hover {
            text-decoration: underline;
            color: #006900;
        }

        .figure {
            font-size: 50px;
            cursor: all-scroll;
        }
    </style>
</head>
<body>
    <div class="box">
        <p>&nbsp;</p>
        <div class="centered">
    
            <table class="chess-board droppable">
                <tbody>
                <tr>
                    <th>8</th>
                    <td class="white" data-x="1" data-y="8" id="a8"></td>
                    <td class="black" data-x="2" data-y="8" id="b8"></td>
                    <td class="white" data-x="3" data-y="8" id="c8"></td>
                    <td class="black" data-x="4" data-y="8" id="d8">
                    </td>
                    <td class="white" data-x="5" data-y="8" id="e8">
                        <span class="figure draggable" data-color="black" data-type="king" draggable="true">♚</span></td>
                    </td>
                    <td class="black" data-x="6" data-y="8" id="f8"></td>
                    <td class="white" data-x="7" data-y="8" id="g8"></td>
                    <td class="black" data-x="8" data-y="8" id="h8"></td>
                </tr>
                <tr>
                    <th>7</th>
                    <td class="black" data-x="1" data-y="7" id="a7">
                        <span class="figure draggable" data-color="black" data-type="pawn" draggable="true">♟</span></td>
                    </td>
                    <td class="white" data-x="2" data-y="7" id="b7">
                        <span class="figure draggable" data-color="black" data-type="pawn" draggable="true">♟</span></td>
                    </td>
                    <td class="black" data-x="3" data-y="7" id="c7">
                        <span class="figure draggable" data-color="black" data-type="pawn" draggable="true">♟</span></td>
                    </td>
                    <td class="white" data-x="4" data-y="7" id="d7">
                        <span class="figure draggable" data-color="black" data-type="pawn" draggable="true">♟</span></td>
                    </td>
                    <td class="black" data-x="5" data-y="7" id="e7">
                        <span class="figure draggable" data-color="black" data-type="pawn" draggable="true">♟</span></td>
                    </td>
                    <td class="white" data-x="6" data-y="7" id="f7">
                        <span class="figure draggable" data-color="black" data-type="pawn" draggable="true">♟</span></td>
                    </td>
                    <td class="black" data-x="7" data-y="7" id="g7">
                        <span class="figure draggable" data-color="black" data-type="pawn" draggable="true">♟</span></td>
                    </td>
                    <td class="white" data-x="8" data-y="7" id="h7">
                        <span class="figure draggable" data-color="black" data-type="pawn" draggable="true">♟</span></td>
                    </td>
                </tr>
                <tr>
                    <th>6</th>
                    <td class="white" data-x="1" data-y="6" id="a6"></td>
                    <td class="black" data-x="2" data-y="6" id="b6"></td>
                    <td class="white" data-x="3" data-y="6" id="c6"></td>
                    <td class="black" data-x="4" data-y="6" id="d6"></td>
                    <td class="white" data-x="5" data-y="6" id="e6"></td>
                    <td class="black" data-x="6" data-y="6" id="f6"></td>
                    <td class="white" data-x="7" data-y="6" id="g6"></td>
                    <td class="black" data-x="8" data-y="6" id="h6"></td>
                </tr>
                <tr>
                    <th>5</th>
                    <td class="black" data-x="1" data-y="5" id="a5"></td>
                    <td class="white" data-x="2" data-y="5" id="b5"></td>
                    <td class="black" data-x="3" data-y="5" id="c5"></td>
                    <td class="white" data-x="4" data-y="5" id="d5"></td>
                    <td class="black" data-x="5" data-y="5" id="e5"></td>
                    <td class="white" data-x="6" data-y="5" id="f5"></td>
                    <td class="black" data-x="7" data-y="5" id="g5"></td>
                    <td class="white" data-x="8" data-y="5" id="h5"></td>
                </tr>
                <tr>
                    <th>4</th>
                    <td class="white" data-x="1" data-y="4" id="a4"></td>
                    <td class="black" data-x="2" data-y="4" id="b4"></td>
                    <td class="white" data-x="3" data-y="4" id="c4"></td>
                    <td class="black" data-x="4" data-y="4" id="d4"></td>
                    <td class="white" data-x="5" data-y="4" id="e4"></td>
                    <td class="black" data-x="6" data-y="4" id="f4"></td>
                    <td class="white" data-x="7" data-y="4" id="g4"></td>
                    <td class="black" data-x="8" data-y="4" id="h4"></td>
                </tr>
                <tr>
                    <th>3</th>
                    <td class="black" data-x="1" data-y="3" id="a3"></td>
                    <td class="white" data-x="2" data-y="3" id="b3"></td>
                    <td class="black" data-x="3" data-y="3" id="c3"></td>
                    <td class="white" data-x="4" data-y="3" id="d3"></td>
                    <td class="black" data-x="5" data-y="3" id="e3"></td>
                    <td class="white" data-x="6" data-y="3" id="f3"></td>
                    <td class="black" data-x="7" data-y="3" id="g3"></td>
                    <td class="white" data-x="8" data-y="3" id="h3"></td>
                </tr>
                <tr>
                    <th>2</th>
                    <td class="white" data-x="1" data-y="2" id="a2">
                        <span class="figure draggable" data-color="white" data-type="pawn" draggable="true">♙</span></td>
                    <td class="black" data-x="2" data-y="2" id="b2">
                        <span class="figure draggable" data-color="white" data-type="pawn" draggable="true">♙</span></td>
                    </td>
                    <td class="white" data-x="3" data-y="2" id="c2">
                        <span class="figure draggable" data-color="white" data-type="pawn" draggable="true">♙</span></td>
                    </td>
                    <td class="black" data-x="4" data-y="2" id="d2">
                        <span class="figure draggable" data-color="white" data-type="pawn" draggable="true">♙</span></td>
                    </td>
                    <td class="white" data-x="5" data-y="2" id="e2">
                        <span class="figure draggable" data-color="white" data-type="pawn" draggable="true">♙</span></td>
                    </td>
                    <td class="black" data-x="6" data-y="2" id="f2">
                        <span class="figure draggable" data-color="white" data-type="pawn" draggable="true">♙</span></td>
                    </td>
                    <td class="white" data-x="7" data-y="2" id="g2">
                        <span class="figure draggable" data-color="white" data-type="pawn" draggable="true">♙</span></td>
                    </td>
                    <td class="black" data-x="8" data-y="2" id="h2">
                        <span class="figure draggable" data-color="white" data-type="pawn" draggable="true">♙</span></td>
                    </td>
                </tr>
                <tr>
                    <th>1</th>
                    <td class="black" data-x="1" data-y="1" id="a1"></td>
                    <td class="white" data-x="2" data-y="1" id="b1"></td>
                    <td class="black" data-x="3" data-y="1" id="c1"></td>
                    <td class="white" data-x="4" data-y="1" id="d1">
                    </td>
                    <td class="black" data-x="5" data-y="1" id="e1">
                        <span class="figure draggable" data-color="white" data-type="king" draggable="true">♔</span></td>
                    </td>
                    <td class="white" data-x="6" data-y="1" id="f1"></td>
                    <td class="black" data-x="7" data-y="1" id="g1"></td>
                    <td class="white" data-x="8" data-y="1" id="h1"></td>
                </tr>
                <tr>
                    <th></th>
                    <th>a</th>
                    <th>b</th>
                    <th>c</th>
                    <th>d</th>
                    <th>e</th>
                    <th>f</th>
                    <th>g</th>
                    <th>h</th>
                </tr>
                </tbody>
            </table>
    
        </div>
    </div>
<script>
    /**
     * Реализовать
     * на 9
     * 1. Ходы пешек (кроме взятия на проходе)
     * 2. Ходы короля
     * 3. Очередность хода
     * 4. Возможность бить фигуры противника по правилам
     *
     * на 10
     * + пешка - взятие на проходе
     * + короля нельзя бить
     * + ходы любой другой фигуры (кроме коня) по правилам (бить фигуры противника, в том числе)
     */
     "use strict";
    const figures = document.querySelectorAll('.draggable');
    const cells = document.querySelectorAll('td');
    const kings = document.querySelectorAll('[data-type="king"]');
    // console.log(figures);
    let currentFigure;
    let currentColor = 'white';
    const startPosition = {
        x: null,
        y: null,
    }

    function doTurn (cell) {
        currentColor = currentColor === 'white' ? 'black' : 'white';
        cell.append(currentFigure);
        // console.log('11111111111111111111111111111');
        // console.log(figures);
    }

    figures.forEach(figure => {
        figure.draggable = true;
        figure.addEventListener('dragstart', () => {
            currentFigure = figure;
            startPosition.x = +figure.parentElement.dataset.x;
            startPosition.y = +figure.parentElement.dataset.y;

        })
    })

    function checkShah(x, y, color){
        // const king = document.querySelector(`[data-type="king"][data-color=${color}]`);
        let enemyColor = color === 'white' ? 'black' : 'white';
        const enemyFigures = document.querySelectorAll(`[data-color=${enemyColor}]`);
        for(let i = 0; i < enemyFigures.length; i++){
            // if(enemy.dataset.type === 'pawn' && Math.abs(king.parentElement.dataset.x - +enemy.parentElement.dataset.x) === 1){
            //     if(color === 'white' && +enemy.parentElement.dataset.y === +king.parentElement.dataset.y + 1){
            //         return true;
            //     } else if(color === 'black' && +enemy.parentElement.dataset.y === +king.parentElement.dataset.y - 1){
            //         return true;
            //     } else{
            //         return false;
            //     }
            // }
            if(enemyFigures[i].dataset.type === 'pawn' && Math.abs(x - +enemyFigures[i].parentElement.dataset.x) === 1){
                if(color === 'white' && +enemyFigures[i].parentElement.dataset.y === y + 1){
                    return true;
                } else if(color === 'black' && +enemyFigures[i].parentElement.dataset.y === y - 1){
                    return true;
                }
            }
            if(enemyFigures[i].dataset.type === 'king' && Math.abs(enemyFigures[i].parentElement.dataset.x - x) <= 1
                && Math.abs(y - enemyFigures[i].parentElement.dataset.y) <= 1){
                    return true;
            }
        }
        return false;
    }

    cells.forEach(cell => {
        cell.addEventListener('dragover', e => e.preventDefault())
        cell.addEventListener('drop', e => {
            if (currentFigure.dataset.color !== currentColor) {
                return alert('Не ваш ход!!!');
            }

            const x = +cell.dataset.x;
            const y = +cell.dataset.y;
            // const figuresNew = document.querySelectorAll('.draggable');

            if (currentFigure.dataset.type === 'pawn' && currentFigure.dataset.color === 'white' ) {

                if (startPosition.x === x && ((y - startPosition.y === 1)||(startPosition.y === 2 && y - startPosition.y === 2)) 
                    && !cell.querySelector('.figure')) {
                    doTurn(cell);
                    return;
                }

                if (Math.abs(x - startPosition.x) === 1 && y - startPosition.y === 1 && cell.querySelector('.figure').dataset.color === 'black'
                    && cell.querySelector('.figure').dataset.type !== 'king') {
                    cell.removeChild(cell.querySelector('.figure'));
                    doTurn(cell);
                    return;
                }
            }

            if (currentFigure.dataset.type === 'pawn' && currentFigure.dataset.color === 'black') {
                if (startPosition.x === x && ((startPosition.y - y === 1)||(startPosition.y === 7 && startPosition.y - y=== 2)) 
                    && !cell.querySelector('.figure')) {
                    doTurn(cell);
                    return;
                }
                if (Math.abs(x - startPosition.x) === 1 && startPosition.y - y === 1 && cell.querySelector('.figure').dataset.color === 'white' 
                    && cell.querySelector('.figure').dataset.type !== 'king') {
                    cell.removeChild(cell.querySelector('.figure'));
                    doTurn(cell);
                    return;
                }
            }
            // Ходы королей
            if (currentFigure.dataset.type === 'king' && currentFigure.dataset.color === currentColor) {

                if(checkShah(x, y, currentColor)){
                    return alert('Король не может ходить под бой!!!Сделайте другой ход!');
                };
                if (Math.abs(x - startPosition.x) <= 1 && Math.abs(y - startPosition.y) <= 1) {
                    if(!cell.querySelector('.figure')){
                        doTurn(cell);
                        return;
                    } else if(cell.querySelector('.figure').dataset.color !== currentColor){
                        cell.removeChild(cell.querySelector('.figure'));
                        doTurn(cell);
                        return;
                    }

                }
            }

            // if (currentFigure.dataset.type === 'king' && currentFigure.dataset.color === 'black') {

            //     if(checkShah(x, y, currentColor)){
            //         return alert('Король не может ходить под бой!!!');
            //     };

            //     if (Math.abs(x - startPosition.x) <= 1 && Math.abs(y - startPosition.y) <= 1) {
            //         if(!cell.querySelector('.figure')){
            //             doTurn(cell);
            //             return;
            //         } else if(cell.querySelector('.figure').dataset.color === 'white'){
            //             cell.removeChild(cell.querySelector('.figure'));
            //             doTurn(cell);
            //             return;
            //         }

            //     }
            // }

        })

    })

</script>


</body></html>